{PRODUCTOR}

"p-buffer" [] 0 ++
              0 ++
              0 ++
              0 ++
shared.get-or-create .BUFFER

"p-wh" 0 shared.get-or-create .WH
"p-rh" 0 shared.get-or-create .RH

"p-pc-1-n" 0 semaphore.create .N
"p-pc-1-s" 1 semaphore.create .S
"p-pc-1-e" $BUFFER len semaphore.create .E

[] "😀" ++
   "🤣" ++
   "😍" ++
   "😇" ++
   "🤪" ++
   "🥸" ++
   "🥳" ++
   "🥺" ++
   "🤩" ++
   "🤬" ++
   "🥶" ++
   "🏈" ++
   "🥌" ++
   "🚌" ++
   "🚝" ++
   "🛞" ++
   "🥝" ++
   "🍓" ++
   "🍙" ++
   "🍿" ++
   "👩‍" ++
.lista


:main

    "Insertando: " console.print

    $lista dup len random * get dup 
    console.print
    "" swap ++ " (" ++ process.pid ++ ")" ++
    (insertar)

    " [OK]" console.println

    1000 timer.sleep

@main


:insertar
   $E semaphore.p
   $S semaphore.p


   $BUFFER $WH rot set

   $WH $WH 1 + $BUFFER len % <-

   $S semaphore.v
   $N semaphore.v

   return
    